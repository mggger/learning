# 状态管理
大多数流处理应用都有状态， 比如kafka-streams的StateStoreSupplier, 创建topic来保存状态。

## Flink state

flink根据key来访问和维护状态， 它具有以下几种类型:

- Value state: 每个key对应一个值
- List state: 每个key对应一系列的值
- Map state: 每个key对应一个k-v map.


并提供了以下的状态操作:

- List State
- Union list state
- Broadcast state


### State 存储
1. 内存， 将状态存储在内存(JVM heap).
2. RocksDB, 写到本地磁盘， 这种方式会比第一种慢.


### 状态恢复

对于故障， flink通过Checkpoints, Savepoints来保证重启后恢复状态。

flink的实现流程如下:
1. 停止数据的摄入, 重启application。
2. 重新设置所有任务的状态根据最晚的checkpoints。
3. 开始数据的摄入.


flink状态恢复的算法基于state checkpoints。 checkpoints是间隔性， 自动生成根据配置。 
savepoints是需要用户来生成， 手动清除的。


### 状态操作

